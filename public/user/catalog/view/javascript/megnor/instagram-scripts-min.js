!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Instafeed=e()}(this,(function(){"use strict";function t(t,e){if(!t)throw new Error(e)}function e(e){t(!e||"object"==typeof e,"options must be an object, got "+e+" ("+typeof e+")");var i={accessToken:null,accessTokenTimeout:1e4,after:null,apiTimeout:1e4,apiLimit:null,before:null,debug:!1,error:null,filter:null,limit:null,mock:!1,render:null,sort:null,success:null,target:"instafeed",template:'<a href="{{link}}"><img title="{{caption}}" src="{{image}}" /></a>',templateBoundaries:["{{","}}"],transform:null};if(e)for(var s in i)void 0!==e[s]&&(i[s]=e[s]);t("string"==typeof i.target||"object"==typeof i.target,"target must be a string or DOM node, got "+i.target+" ("+typeof i.target+")"),t("string"==typeof i.accessToken||"function"==typeof i.accessToken,"accessToken must be a string or function, got "+i.accessToken+" ("+typeof i.accessToken+")"),t("number"==typeof i.accessTokenTimeout,"accessTokenTimeout must be a number, got "+i.accessTokenTimeout+" ("+typeof i.accessTokenTimeout+")"),t("number"==typeof i.apiTimeout,"apiTimeout must be a number, got "+i.apiTimeout+" ("+typeof i.apiTimeout+")"),t("boolean"==typeof i.debug,"debug must be true or false, got "+i.debug+" ("+typeof i.debug+")"),t("boolean"==typeof i.mock,"mock must be true or false, got "+i.mock+" ("+typeof i.mock+")"),t("object"==typeof i.templateBoundaries&&2===i.templateBoundaries.length&&"string"==typeof i.templateBoundaries[0]&&"string"==typeof i.templateBoundaries[1],"templateBoundaries must be an array of 2 strings, got "+i.templateBoundaries+" ("+typeof i.templateBoundaries+")"),t(!i.template||"string"==typeof i.template,"template must null or string, got "+i.template+" ("+typeof i.template+")"),t(!i.error||"function"==typeof i.error,"error must be null or function, got "+i.error+" ("+typeof i.error+")"),t(!i.before||"function"==typeof i.before,"before must be null or function, got "+i.before+" ("+typeof i.before+")"),t(!i.after||"function"==typeof i.after,"after must be null or function, got "+i.after+" ("+typeof i.after+")"),t(!i.success||"function"==typeof i.success,"success must be null or function, got "+i.success+" ("+typeof i.success+")"),t(!i.filter||"function"==typeof i.filter,"filter must be null or function, got "+i.filter+" ("+typeof i.filter+")"),t(!i.transform||"function"==typeof i.transform,"transform must be null or function, got "+i.transform+" ("+typeof i.transform+")"),t(!i.sort||"function"==typeof i.sort,"sort must be null or function, got "+i.sort+" ("+typeof i.sort+")"),t(!i.render||"function"==typeof i.render,"render must be null or function, got "+i.render+" ("+typeof i.render+")"),t(!i.limit||"number"==typeof i.limit,"limit must be null or number, got "+i.limit+" ("+typeof i.limit+")"),t(!i.apiLimit||"number"==typeof i.apiLimit,"apiLimit must null or number, got "+i.apiLimit+" ("+typeof i.apiLimit+")"),this._state={running:!1,node:null,token:null,paging:null,pool:[]},this._options=i}return e.prototype.run=function(){var t=this;return this._debug("run","options",this._options),this._debug("run","state",this._state),this._state.running?(this._debug("run","already running, skipping"),!1):(this._start(),this._debug("run","getting dom node"),"string"==typeof this._options.target?this._state.node=document.getElementById(this._options.target):this._state.node=this._options.target,this._state.node?(this._debug("run","got dom node",this._state.node),this._debug("run","getting access token"),this._getAccessToken((function(e,i){if(e)return t._debug("onTokenReceived","error",e),void t._fail(new Error("error getting access token: "+e.message));t._debug("onTokenReceived","got token",i),t._state.token=i,t._showNext((function(e){if(e)return t._debug("onNextShown","error",e),void t._fail(e);t._finish()}))})),!0):(this._fail(new Error("no element found with ID "+this._options.target)),!1))},e.prototype.hasNext=function(){var t=this._state.paging,e=this._state.pool;return this._debug("hasNext","paging",t),this._debug("hasNext","pool",e.length,e),e.length>0||t&&"string"==typeof t.next},e.prototype.next=function(){var t=this;return t.hasNext()?t._state.running?(t._debug("next","already running, skipping"),!1):(t._start(),void t._showNext((function(e){if(e)return t._debug("onNextShown","error",e),void t._fail(e);t._finish()}))):(t._debug("next","hasNext is false, skipping"),!1)},e.prototype._showNext=function(t){var e=this,i=null,s=null,n="number"==typeof this._options.limit;if(e._debug("showNext","pool",e._state.pool.length,e._state.pool),e._state.pool.length>0){if(s=n?e._state.pool.splice(0,e._options.limit):e._state.pool.splice(0),e._debug("showNext","items from pool",s.length,s),e._debug("showNext","updated pool",e._state.pool.length,e._state.pool),e._options.mock)e._debug("showNext","mock enabled, skipping render");else try{e._renderData(s)}catch(e){return void t(e)}t(null)}else e._state.paging&&"string"==typeof e._state.paging.next?i=e._state.paging.next:(i="https://graph.instagram.com/me/media?fields=caption,id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token="+e._state.token,e._options.apiLimit||"number"!=typeof e._options.limit?"number"==typeof e._options.apiLimit&&(e._debug("showNext","apiLimit set, overriding limit",e._options.apiLimit,e._options.limit),i=i+"&limit="+e._options.apiLimit):(e._debug("showNext","no apiLimit set, falling back to limit",e._options.apiLimit,e._options.limit),i=i+"&limit="+e._options.limit)),e._debug("showNext","making request",i),e._makeApiRequest(i,(function(i,s){var n=null;if(i)return e._debug("onResponseReceived","error",i),void t(new Error("api request error: "+i.message));e._debug("onResponseReceived","data",s),e._success(s),e._debug("onResponseReceived","setting paging",s.paging),e._state.paging=s.paging;try{if(n=e._processData(s),e._debug("onResponseReceived","processed data",n),n.unused&&n.unused.length>0){e._debug("onResponseReceived","saving unused to pool",n.unused.length,n.unused);for(var o=0;o<n.unused.length;o++)e._state.pool.push(n.unused[o])}}catch(e){return void t(e)}if(e._options.mock)e._debug("onResponseReceived","mock enabled, skipping append");else try{e._renderData(n.items)}catch(e){return void t(e)}t(null)}))},e.prototype._processData=function(t){var e="function"==typeof this._options.transform,i="function"==typeof this._options.filter,s="function"==typeof this._options.sort,n="number"==typeof this._options.limit,o=[],r=null,a=null,l=null,h=null,c=null;if(this._debug("processData","hasFilter",i,"hasTransform",e,"hasSort",s,"hasLimit",n),"object"!=typeof t||"object"!=typeof t.data||t.data.length<=0)return null;for(var u=0;u<t.data.length;u++){if(a=this._getItemData(t.data[u]),e)try{l=this._options.transform(a),this._debug("processData","transformed item",a,l)}catch(t){throw this._debug("processData","error calling transform",t),new Error("error in transform: "+t.message)}else l=a;if(i){try{h=this._options.filter(l),this._debug("processData","filter item result",l,h)}catch(t){throw this._debug("processData","error calling filter",t),new Error("error in filter: "+t.message)}h&&o.push(l)}else o.push(l)}if(s)try{o.sort(this._options.sort)}catch(t){throw this._debug("processData","error calling sort",t),new Error("error in sort: "+t.message)}return n&&(r=o.length-this._options.limit,this._debug("processData","checking limit",o.length,this._options.limit,r),r>0&&(c=o.slice(o.length-r),this._debug("processData","unusedItems",c.length,c),o.splice(o.length-r,r))),{items:o,unused:c}},e.prototype._extractTags=function(t){var e=/#([^\s]+)/gi,i=/[~`!@#$%^&*\(\)\-\+={}\[\]:;"'<>\?,\./|\\\s]+/i,s=[],n=null;if("string"==typeof t)for(;null!==(n=e.exec(t));)!1===i.test(n[1])&&s.push(n[1]);return s},e.prototype._getItemData=function(t){var e=null,i=null;switch(t.media_type){case"IMAGE":e="image",i=t.media_url;break;case"VIDEO":e="video",i=t.thumbnail_url;break;case"CAROUSEL_ALBUM":e="album",i=t.media_url}return{caption:t.caption,tags:this._extractTags(t.caption),id:t.id,image:i,link:t.permalink,model:t,timestamp:t.timestamp,type:e,username:t.username}},e.prototype._renderData=function(t){var e="string"==typeof this._options.template,i="function"==typeof this._options.render,s=null,n=null,o=null,r="";if(this._debug("renderData","hasTemplate",e,"hasRender",i),!("object"!=typeof t||t.length<=0)){for(var a=0;a<t.length;a++){if(s=t[a],i)try{n=this._options.render(s,this._options),this._debug("renderData","custom render result",s,n)}catch(t){throw this._debug("renderData","error calling render",t),new Error("error in render: "+t.message)}else e&&(n=this._basicRender(s));n?r+=n:this._debug("renderData","render item did not return any content",s)}for(this._debug("renderData","html content",r),(o=document.createElement("div")).innerHTML=r,this._debug("renderData","container",o,o.childNodes.length,o.childNodes);o.childNodes.length>0;)this._debug("renderData","appending child",o.childNodes[0]),this._state.node.appendChild(o.childNodes[0])}},e.prototype._basicRender=function(t){for(var e=new RegExp(this._options.templateBoundaries[0]+"([\\s\\w.]+)"+this._options.templateBoundaries[1],"gm"),i=this._options.template,s=null,n="",o=0,r=null,a=null;null!==(s=e.exec(i));)r=s[1],n+=i.slice(o,s.index),(a=this._valueForKeyPath(r,t))&&(n+=a.toString()),o=e.lastIndex;return o<i.length&&(n+=i.slice(o,i.length)),n},e.prototype._valueForKeyPath=function(t,e){for(var i=/([\w]+)/gm,s=null,n=e;null!==(s=i.exec(t));){if("object"!=typeof n)return null;n=n[s[1]]}return n},e.prototype._fail=function(t){!this._runHook("error",t)&&console&&"function"==typeof console.error&&console.error(t),this._state.running=!1},e.prototype._start=function(){this._state.running=!0,this._runHook("before")},e.prototype._finish=function(){this._runHook("after"),this._state.running=!1},e.prototype._success=function(t){this._runHook("success",t),this._state.running=!1},e.prototype._makeApiRequest=function(t,e){var i=!1,s=this,n=null,o=function(t,s){i||(i=!0,e(t,s))};(n=new XMLHttpRequest).ontimeout=function(){o(new Error("api request timed out"))},n.onerror=function(){o(new Error("api connection error"))},n.onload=function(t){var e=n.getResponseHeader("Content-Type"),i=null;if(s._debug("apiRequestOnLoad","loaded",t),s._debug("apiRequestOnLoad","response status",n.status),s._debug("apiRequestOnLoad","response content type",e),e.indexOf("application/json")>=0)try{i=JSON.parse(n.responseText)}catch(t){return s._debug("apiRequestOnLoad","json parsing error",t,n.responseText),void o(new Error("error parsing response json"))}200===n.status?o(null,i):i&&i.error?o(new Error(i.error.code+" "+i.error.message)):o(new Error("status code "+n.status))},n.open("GET",t,!0),n.timeout=this._options.apiTimeout,n.send()},e.prototype._getAccessToken=function(t){var e=!1,i=this,s=null,n=function(i,n){e||(e=!0,clearTimeout(s),t(i,n))};if("function"==typeof this._options.accessToken){this._debug("getAccessToken","calling accessToken as function"),s=setTimeout((function(){i._debug("getAccessToken","timeout check",e),n(new Error("accessToken timed out"),null)}),this._options.accessTokenTimeout);try{this._options.accessToken((function(t,s){i._debug("getAccessToken","received accessToken callback",e,t,s),n(t,s)}))}catch(t){this._debug("getAccessToken","error invoking the accessToken as function",t),n(t,null)}}else this._debug("getAccessToken","treating accessToken as static",typeof this._options.accessToken),n(null,this._options.accessToken)},e.prototype._debug=function(){var t=null;this._options.debug&&console&&"function"==typeof console.log&&((t=[].slice.call(arguments))[0]="[Instafeed] ["+t[0]+"]",console.log.apply(null,t))},e.prototype._runHook=function(t,e){var i=!1;if("function"==typeof this._options[t])try{this._options[t](e),i=!0}catch(e){this._debug("runHook","error calling hook",t,e)}return i},e})),
!function(t,e){"use strict";function r(r,a,i,u,l){function f(){L=t.devicePixelRatio>1,i=c(i),a.delay>=0&&setTimeout(function(){s(!0)},a.delay),(a.delay<0||a.combined)&&(u.e=v(a.throttle,function(t){"resize"===t.type&&(w=B=-1),s(t.all)}),u.a=function(t){t=c(t),i.push.apply(i,t)},u.g=function(){return i=n(i).filter(function(){return!n(this).data(a.loadedName)})},u.f=function(t){for(var e=0;e<t.length;e++){var r=i.filter(function(){return this===t[e]});r.length&&s(!1,r)}},s(),n(a.appendScroll).on("scroll."+l+" resize."+l,u.e))}function c(t){var i=a.defaultImage,o=a.placeholder,u=a.imageBase,l=a.srcsetAttribute,f=a.loaderAttribute,c=a._f||{};t=n(t).filter(function(){var t=n(this),r=m(this);return!t.data(a.handledName)&&(t.attr(a.attribute)||t.attr(l)||t.attr(f)||c[r]!==e)}).data("plugin_"+a.name,r);for(var s=0,d=t.length;s<d;s++){var A=n(t[s]),g=m(t[s]),h=A.attr(a.imageBaseAttribute)||u;g===N&&h&&A.attr(l)&&A.attr(l,b(A.attr(l),h)),c[g]===e||A.attr(f)||A.attr(f,c[g]),g===N&&i&&!A.attr(E)?A.attr(E,i):g===N||!o||A.css(O)&&"none"!==A.css(O)||A.css(O,"url('"+o+"')")}return t}function s(t,e){if(!i.length)return void(a.autoDestroy&&r.destroy());for(var o=e||i,u=!1,l=a.imageBase||"",f=a.srcsetAttribute,c=a.handledName,s=0;s<o.length;s++)if(t||e||A(o[s])){var g=n(o[s]),h=m(o[s]),b=g.attr(a.attribute),v=g.attr(a.imageBaseAttribute)||l,p=g.attr(a.loaderAttribute);g.data(c)||a.visibleOnly&&!g.is(":visible")||!((b||g.attr(f))&&(h===N&&(v+b!==g.attr(E)||g.attr(f)!==g.attr(F))||h!==N&&v+b!==g.css(O))||p)||(u=!0,g.data(c,!0),d(g,h,v,p))}u&&(i=n(i).filter(function(){return!n(this).data(c)}))}function d(t,e,r,i){++z;var o=function(){y("onError",t),p(),o=n.noop};y("beforeLoad",t);var u=a.attribute,l=a.srcsetAttribute,f=a.sizesAttribute,c=a.retinaAttribute,s=a.removeAttribute,d=a.loadedName,A=t.attr(c);if(i){var g=function(){s&&t.removeAttr(a.loaderAttribute),t.data(d,!0),y(T,t),setTimeout(p,1),g=n.noop};t.off(I).one(I,o).one(D,g),y(i,t,function(e){e?(t.off(D),g()):(t.off(I),o())})||t.trigger(I)}else{var h=n(new Image);h.one(I,o).one(D,function(){t.hide(),e===N?t.attr(C,h.attr(C)).attr(F,h.attr(F)).attr(E,h.attr(E)):t.css(O,"url('"+h.attr(E)+"')"),t[a.effect](a.effectTime),s&&(t.removeAttr(u+" "+l+" "+c+" "+a.imageBaseAttribute),f!==C&&t.removeAttr(f)),t.data(d,!0),y(T,t),h.remove(),p()});var m=(L&&A?A:t.attr(u))||"";h.attr(C,t.attr(f)).attr(F,t.attr(l)).attr(E,m?r+m:null),h.complete&&h.trigger(D)}}function A(t){var e=t.getBoundingClientRect(),r=a.scrollDirection,n=a.threshold,i=h()+n>e.top&&-n<e.bottom,o=g()+n>e.left&&-n<e.right;return"vertical"===r?i:"horizontal"===r?o:i&&o}function g(){return w>=0?w:w=n(t).width()}function h(){return B>=0?B:B=n(t).height()}function m(t){return t.tagName.toLowerCase()}function b(t,e){if(e){var r=t.split(",");t="";for(var a=0,n=r.length;a<n;a++)t+=e+r[a].trim()+(a!==n-1?",":"")}return t}function v(t,e){var n,i=0;return function(o,u){function l(){i=+new Date,e.call(r,o)}var f=+new Date-i;n&&clearTimeout(n),f>t||!a.enableThrottle||u?l():n=setTimeout(l,t-f)}}function p(){--z,i.length||z||y("onFinishedAll")}function y(t,e,n){return!!(t=a[t])&&(t.apply(r,[].slice.call(arguments,1)),!0)}var z=0,w=-1,B=-1,L=!1,T="afterLoad",D="load",I="error",N="img",E="src",F="srcset",C="sizes",O="background-image";"event"===a.bind||o?f():n(t).on(D+"."+l,f)}function a(a,o){var u=this,l=n.extend({},u.config,o),f={},c=l.name+"-"+ ++i;return u.config=function(t,r){return r===e?l[t]:(l[t]=r,u)},u.addItems=function(t){return f.a&&f.a("string"===n.type(t)?n(t):t),u},u.getItems=function(){return f.g?f.g():{}},u.update=function(t){return f.e&&f.e({},!t),u},u.force=function(t){return f.f&&f.f("string"===n.type(t)?n(t):t),u},u.loadAll=function(){return f.e&&f.e({all:!0},!0),u},u.destroy=function(){return n(l.appendScroll).off("."+c,f.e),n(t).off("."+c),f={},e},r(u,l,a,f,c),l.chainable?a:u}var n=t.jQuery||t.Zepto,i=0,o=!1;n.fn.Lazy=n.fn.lazy=function(t){return new a(this,t)},n.Lazy=n.lazy=function(t,r,i){if(n.isFunction(r)&&(i=r,r=[]),n.isFunction(i)){t=n.isArray(t)?t:[t],r=n.isArray(r)?r:[r];for(var o=a.prototype.config,u=o._f||(o._f={}),l=0,f=t.length;l<f;l++)(o[t[l]]===e||n.isFunction(o[t[l]]))&&(o[t[l]]=i);for(var c=0,s=r.length;c<s;c++)u[r[c]]=t[0]}},a.prototype.config={name:"lazy",chainable:!0,autoDestroy:!0,bind:"load",threshold:500,visibleOnly:!1,appendScroll:t,scrollDirection:"both",imageBase:null,defaultImage:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",placeholder:null,delay:-1,combined:!1,attribute:"data-src",srcsetAttribute:"data-srcset",sizesAttribute:"data-sizes",retinaAttribute:"data-retina",loaderAttribute:"data-loader",imageBaseAttribute:"data-imagebase",removeAttribute:!0,handledName:"handled",loadedName:"loaded",effect:"show",effectTime:0,enableThrottle:!0,throttle:250,beforeLoad:e,afterLoad:e,onError:e,onFinishedAll:e},n(t).on("load",function(){o=!0})}(window);